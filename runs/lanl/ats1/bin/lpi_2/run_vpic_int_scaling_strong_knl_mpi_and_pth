#!/bin/bash

########################################################################################################################################################
# Configure modules.

module load friendly-testing
module load sandbox
module swap intel intel/17.0.4
module swap cray-mpich cray-mpich/7.5.4
module swap craype-haswell craype-mic-knl

module list

########################################################################################################################################################
# Preliminary stuff.

vtime=''
vnuma='numactl --preferred=1'
voc='--vm-overcommit=enable'

########################################################################################################################################################
# Large DDR problem, strong scaled across 8 nodes.

########################################################################################################################################################
# MPI + Pthreads, 1 rank/core, 4 threads/rank.

srun -n  544 -N 8 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0008_nppn_068_ntpp_004.Linux --tpp 4 >& lpi_ddr_nn_0008_nppn_068_ntpp_004.log
srun -n  512 -N 8 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0008_nppn_064_ntpp_004.Linux --tpp 4 >& lpi_ddr_nn_0008_nppn_064_ntpp_004.log

srun -n  272 -N 4 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0004_nppn_068_ntpp_004.Linux --tpp 4 >& lpi_ddr_nn_0004_nppn_068_ntpp_004.log
srun -n  256 -N 4 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0004_nppn_064_ntpp_004.Linux --tpp 4 >& lpi_ddr_nn_0004_nppn_064_ntpp_004.log

srun -n  136 -N 2 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0002_nppn_068_ntpp_004.Linux --tpp 4 >& lpi_ddr_nn_0002_nppn_068_ntpp_004.log
srun -n  128 -N 2 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0002_nppn_064_ntpp_004.Linux --tpp 4 >& lpi_ddr_nn_0002_nppn_064_ntpp_004.log

srun -n   68 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0001_nppn_068_ntpp_004.Linux --tpp 4 >& lpi_ddr_nn_0001_nppn_068_ntpp_004.log
srun -n   64 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0001_nppn_064_ntpp_004.Linux --tpp 4 >& lpi_ddr_nn_0001_nppn_064_ntpp_004.log
srun -n   34 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0001_nppn_034_ntpp_004.Linux --tpp 4 >& lpi_ddr_nn_0001_nppn_034_ntpp_004.log
srun -n   32 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0001_nppn_032_ntpp_004.Linux --tpp 4 >& lpi_ddr_nn_0001_nppn_032_ntpp_004.log
srun -n   17 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0001_nppn_017_ntpp_004.Linux --tpp 4 >& lpi_ddr_nn_0001_nppn_017_ntpp_004.log
srun -n   16 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0001_nppn_016_ntpp_004.Linux --tpp 4 >& lpi_ddr_nn_0001_nppn_016_ntpp_004.log
srun -n    8 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0001_nppn_008_ntpp_004.Linux --tpp 4 >& lpi_ddr_nn_0001_nppn_008_ntpp_004.log
srun -n    4 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0001_nppn_004_ntpp_004.Linux --tpp 4 >& lpi_ddr_nn_0001_nppn_004_ntpp_004.log
srun -n    2 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0001_nppn_002_ntpp_004.Linux --tpp 4 >& lpi_ddr_nn_0001_nppn_002_ntpp_004.log
srun -n    1 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0001_nppn_001_ntpp_004.Linux --tpp 4 >& lpi_ddr_nn_0001_nppn_001_ntpp_004.log

########################################################################################################################################################
# MPI + Pthreads, 1 rank/core, 2 threads/rank.

srun -n  544 -N 8 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0008_nppn_068_ntpp_002.Linux --tpp 2 >& lpi_ddr_nn_0008_nppn_068_ntpp_002.log
srun -n  512 -N 8 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0008_nppn_064_ntpp_002.Linux --tpp 2 >& lpi_ddr_nn_0008_nppn_064_ntpp_002.log

srun -n  272 -N 4 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0004_nppn_068_ntpp_002.Linux --tpp 2 >& lpi_ddr_nn_0004_nppn_068_ntpp_002.log
srun -n  256 -N 4 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0004_nppn_064_ntpp_002.Linux --tpp 2 >& lpi_ddr_nn_0004_nppn_064_ntpp_002.log

srun -n  136 -N 2 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0002_nppn_068_ntpp_002.Linux --tpp 2 >& lpi_ddr_nn_0002_nppn_068_ntpp_002.log
srun -n  128 -N 2 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0002_nppn_064_ntpp_002.Linux --tpp 2 >& lpi_ddr_nn_0002_nppn_064_ntpp_002.log

srun -n   68 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0001_nppn_068_ntpp_002.Linux --tpp 2 >& lpi_ddr_nn_0001_nppn_068_ntpp_002.log
srun -n   64 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0001_nppn_064_ntpp_002.Linux --tpp 2 >& lpi_ddr_nn_0001_nppn_064_ntpp_002.log
srun -n   34 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0001_nppn_034_ntpp_002.Linux --tpp 2 >& lpi_ddr_nn_0001_nppn_034_ntpp_002.log
srun -n   32 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0001_nppn_032_ntpp_002.Linux --tpp 2 >& lpi_ddr_nn_0001_nppn_032_ntpp_002.log
srun -n   17 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0001_nppn_017_ntpp_002.Linux --tpp 2 >& lpi_ddr_nn_0001_nppn_017_ntpp_002.log
srun -n   16 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0001_nppn_016_ntpp_002.Linux --tpp 2 >& lpi_ddr_nn_0001_nppn_016_ntpp_002.log
srun -n    8 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0001_nppn_008_ntpp_002.Linux --tpp 2 >& lpi_ddr_nn_0001_nppn_008_ntpp_002.log
srun -n    4 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0001_nppn_004_ntpp_002.Linux --tpp 2 >& lpi_ddr_nn_0001_nppn_004_ntpp_002.log
srun -n    2 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0001_nppn_002_ntpp_002.Linux --tpp 2 >& lpi_ddr_nn_0001_nppn_002_ntpp_002.log
srun -n    1 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0001_nppn_001_ntpp_002.Linux --tpp 2 >& lpi_ddr_nn_0001_nppn_001_ntpp_002.log

########################################################################################################################################################
# MPI + Pthreads, 1 rank/core, 1 thread/rank.

srun -n  544 -N 8 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0008_nppn_068_ntpp_001.Linux --tpp 1 >& lpi_ddr_nn_0008_nppn_068_ntpp_001.log
srun -n  512 -N 8 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0008_nppn_064_ntpp_001.Linux --tpp 1 >& lpi_ddr_nn_0008_nppn_064_ntpp_001.log

srun -n  272 -N 4 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0004_nppn_068_ntpp_001.Linux --tpp 1 >& lpi_ddr_nn_0004_nppn_068_ntpp_001.log
srun -n  256 -N 4 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0004_nppn_064_ntpp_001.Linux --tpp 1 >& lpi_ddr_nn_0004_nppn_064_ntpp_001.log

srun -n  136 -N 2 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0002_nppn_068_ntpp_001.Linux --tpp 1 >& lpi_ddr_nn_0002_nppn_068_ntpp_001.log
srun -n  128 -N 2 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0002_nppn_064_ntpp_001.Linux --tpp 1 >& lpi_ddr_nn_0002_nppn_064_ntpp_001.log

srun -n   68 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0001_nppn_068_ntpp_001.Linux --tpp 1 >& lpi_ddr_nn_0001_nppn_068_ntpp_001.log
srun -n   64 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0001_nppn_064_ntpp_001.Linux --tpp 1 >& lpi_ddr_nn_0001_nppn_064_ntpp_001.log
srun -n   34 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0001_nppn_034_ntpp_001.Linux --tpp 1 >& lpi_ddr_nn_0001_nppn_034_ntpp_001.log
srun -n   32 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0001_nppn_032_ntpp_001.Linux --tpp 1 >& lpi_ddr_nn_0001_nppn_032_ntpp_001.log
srun -n   17 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0001_nppn_017_ntpp_001.Linux --tpp 1 >& lpi_ddr_nn_0001_nppn_017_ntpp_001.log
srun -n   16 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0001_nppn_016_ntpp_001.Linux --tpp 1 >& lpi_ddr_nn_0001_nppn_016_ntpp_001.log
srun -n    8 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0001_nppn_008_ntpp_001.Linux --tpp 1 >& lpi_ddr_nn_0001_nppn_008_ntpp_001.log
srun -n    4 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0001_nppn_004_ntpp_001.Linux --tpp 1 >& lpi_ddr_nn_0001_nppn_004_ntpp_001.log
srun -n    2 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0001_nppn_002_ntpp_001.Linux --tpp 1 >& lpi_ddr_nn_0001_nppn_002_ntpp_001.log
srun -n    1 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_ddr_nn_0001_nppn_001_ntpp_001.Linux --tpp 1 >& lpi_ddr_nn_0001_nppn_001_ntpp_001.log

########################################################################################################################################################
# Small HBM problem, strong scaled across 1 node.

########################################################################################################################################################
# MPI + Pthreads, 1 rank/core, 4 threads/rank.

srun -n   68 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_hbm_nn_0001_nppn_068_ntpp_004.Linux --tpp 4 >& lpi_hbm_nn_0001_nppn_068_ntpp_004.log
srun -n   64 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_hbm_nn_0001_nppn_064_ntpp_004.Linux --tpp 4 >& lpi_hbm_nn_0001_nppn_064_ntpp_004.log
srun -n   34 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_hbm_nn_0001_nppn_034_ntpp_004.Linux --tpp 4 >& lpi_hbm_nn_0001_nppn_034_ntpp_004.log
srun -n   32 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_hbm_nn_0001_nppn_032_ntpp_004.Linux --tpp 4 >& lpi_hbm_nn_0001_nppn_032_ntpp_004.log
srun -n   17 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_hbm_nn_0001_nppn_017_ntpp_004.Linux --tpp 4 >& lpi_hbm_nn_0001_nppn_017_ntpp_004.log
srun -n   16 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_hbm_nn_0001_nppn_016_ntpp_004.Linux --tpp 4 >& lpi_hbm_nn_0001_nppn_016_ntpp_004.log
srun -n    8 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_hbm_nn_0001_nppn_008_ntpp_004.Linux --tpp 4 >& lpi_hbm_nn_0001_nppn_008_ntpp_004.log
srun -n    4 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_hbm_nn_0001_nppn_004_ntpp_004.Linux --tpp 4 >& lpi_hbm_nn_0001_nppn_004_ntpp_004.log
srun -n    2 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_hbm_nn_0001_nppn_002_ntpp_004.Linux --tpp 4 >& lpi_hbm_nn_0001_nppn_002_ntpp_004.log
srun -n    1 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_hbm_nn_0001_nppn_001_ntpp_004.Linux --tpp 4 >& lpi_hbm_nn_0001_nppn_001_ntpp_004.log

########################################################################################################################################################
# MPI + Pthreads, 1 rank/core, 2 threads/rank.

srun -n   68 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_hbm_nn_0001_nppn_068_ntpp_002.Linux --tpp 2 >& lpi_hbm_nn_0001_nppn_068_ntpp_002.log
srun -n   64 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_hbm_nn_0001_nppn_064_ntpp_002.Linux --tpp 2 >& lpi_hbm_nn_0001_nppn_064_ntpp_002.log
srun -n   34 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_hbm_nn_0001_nppn_034_ntpp_002.Linux --tpp 2 >& lpi_hbm_nn_0001_nppn_034_ntpp_002.log
srun -n   32 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_hbm_nn_0001_nppn_032_ntpp_002.Linux --tpp 2 >& lpi_hbm_nn_0001_nppn_032_ntpp_002.log
srun -n   17 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_hbm_nn_0001_nppn_017_ntpp_002.Linux --tpp 2 >& lpi_hbm_nn_0001_nppn_017_ntpp_002.log
srun -n   16 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_hbm_nn_0001_nppn_016_ntpp_002.Linux --tpp 2 >& lpi_hbm_nn_0001_nppn_016_ntpp_002.log
srun -n    8 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_hbm_nn_0001_nppn_008_ntpp_002.Linux --tpp 2 >& lpi_hbm_nn_0001_nppn_008_ntpp_002.log
srun -n    4 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_hbm_nn_0001_nppn_004_ntpp_002.Linux --tpp 2 >& lpi_hbm_nn_0001_nppn_004_ntpp_002.log
srun -n    2 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_hbm_nn_0001_nppn_002_ntpp_002.Linux --tpp 2 >& lpi_hbm_nn_0001_nppn_002_ntpp_002.log
srun -n    1 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_hbm_nn_0001_nppn_001_ntpp_002.Linux --tpp 2 >& lpi_hbm_nn_0001_nppn_001_ntpp_002.log

########################################################################################################################################################
# MPI + Pthreads, 1 rank/core, 1 thread/rank.

srun -n   68 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_hbm_nn_0001_nppn_068_ntpp_001.Linux --tpp 1 >& lpi_hbm_nn_0001_nppn_068_ntpp_001.log
srun -n   64 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_hbm_nn_0001_nppn_064_ntpp_001.Linux --tpp 1 >& lpi_hbm_nn_0001_nppn_064_ntpp_001.log
srun -n   34 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_hbm_nn_0001_nppn_034_ntpp_001.Linux --tpp 1 >& lpi_hbm_nn_0001_nppn_034_ntpp_001.log
srun -n   32 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_hbm_nn_0001_nppn_032_ntpp_001.Linux --tpp 1 >& lpi_hbm_nn_0001_nppn_032_ntpp_001.log
srun -n   17 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_hbm_nn_0001_nppn_017_ntpp_001.Linux --tpp 1 >& lpi_hbm_nn_0001_nppn_017_ntpp_001.log
srun -n   16 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_hbm_nn_0001_nppn_016_ntpp_001.Linux --tpp 1 >& lpi_hbm_nn_0001_nppn_016_ntpp_001.log
srun -n    8 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_hbm_nn_0001_nppn_008_ntpp_001.Linux --tpp 1 >& lpi_hbm_nn_0001_nppn_008_ntpp_001.log
srun -n    4 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_hbm_nn_0001_nppn_004_ntpp_001.Linux --tpp 1 >& lpi_hbm_nn_0001_nppn_004_ntpp_001.log
srun -n    2 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_hbm_nn_0001_nppn_002_ntpp_001.Linux --tpp 1 >& lpi_hbm_nn_0001_nppn_002_ntpp_001.log
srun -n    1 -N 1 -c 4 --cpu_bind=threads ${voc} ${vtime} ${vnuma} lpi_hbm_nn_0001_nppn_001_ntpp_001.Linux --tpp 1 >& lpi_hbm_nn_0001_nppn_001_ntpp_001.log
